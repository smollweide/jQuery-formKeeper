!function(a){"use strict";FormKeeper.Extension.Date=Class.extend({errorMessage:{"default":'The date you entered must be in Format "{{format}}".',suggestion:' Did you mean <a data-form-keeper-suggestion="{{suggestion}}">{{suggestion}}</a>?'},defaults:{format:"DD.MM.YYYY",separator:"."},init:function(){return this.utils=FormKeeper.Utils,this.monthLeadingNull=!1,this.dayLeadingNull=!1,this.startWithYear=!1,this.options={},this},validateSelector:function(a){var b=this,c=a.data("form-keeper").date,d=b.utils.isTagName(a,"input"),e=b.utils.isTagName(a,"textarea");return d||e?b.validate(a.val(),c):(b.utils.console("warn","FormKeeper.Extension.Date.validateSelector: the selector must be an input or textarea tag"),!0)},validate:function(b,c){var d,e,f=this,g={valid:!0},h={valid:!1},i=f.utils.isMandatoryCase(b),j=!f.utils.isString(b);return i?g:j?h:(f.options=a.extend({},f.defaults,c),d=f.options.format.split(f.options.separator),f.isValidDateArray(d)?(f.logFormatUnknown("validate"),g):(e=b.split(f.options.separator),f.isValidDateArray(e)?h:-1!==d[0].search("Y")?(f.startWithYear=!0,f.getValidateReturn(d,e)):-1!==d[2].search("Y")?(f.startWithYear=!1,f.getValidateReturn(d,e)):(f.logFormatUnknown("validate"),g)))},getValidateReturn:function(a,b){var c,d=this,e={valid:!0},f=function(a){return d.utils.isUndefined(a)?{valid:!1}:{valid:!1,suggestion:d.getFormatSuggestionDate(a)}};return d.startWithYear||(b=b.reverse(),a=a.reverse()),d.isValidDate(b,a)?(c=d.getSuggestionDate([b[0],b[1],b[2]]),null===c[0]||isNaN(c[0])?f():c[0]!==parseInt(b[0],10)?f(c):c[1]!==parseInt(b[1],10)?f(c):c[2]!==parseInt(b[2],10)?f(c):e):f()},getSuggestionDate:function(a){var b=parseInt(a[0],10),c=parseInt(a[1],10)-1,d=parseInt(a[2],10),e=new Date(b,c,d);return[e.getFullYear(),e.getMonth()+1,e.getDate()]},getFormatSuggestionDate:function(a){var b=this;return 3!==a.length&&b.utils.console("error",'FromKeeper.Extension.Date.getFormatSuggestionDate: invalid argument "dateArr"'),b.startWithYear||a.reverse(),b.monthLeadingNull&&(a[1]=b.utils.toLeadingNull(a[1])),b.dayLeadingNull&&(a[0]=b.utils.toLeadingNull(a[0])),a.join(b.options.separator)},logFormatUnknown:function(a){this.utils.console("warn","FormKeeper.Extension.Date."+a+" the format is unknown")},isValidDateArray:function(a){return!this.utils.isArray(a)||3!==a.length},isValidDate:function(a,b){var c=this;return c.isValidYear(b[0],a[0])&&c.isValidMonth(b[1],a[1])&&c.isValidDay(b[2],a[2])},isValidYear:function(a,b){return 4===a.length&&4===b.length},isValidMonth:function(a,b){var c=this,d="MM"===a,e=b.length;return d||"M"===a?d?(c.monthLeadingNull=!0,2===e):(c.monthLeadingNull=!1,!(2===e&&parseInt(b,10)<=9)):!0},isValidDay:function(a,b){var c=this,d="DD"===a,e=b.length;return d||"D"===a?d?(c.dayLeadingNull=!0,2===e):(c.dayLeadingNull=!1,!(2===e&&parseInt(b,10)<=9)):!0}})}(FormKeeper.$);